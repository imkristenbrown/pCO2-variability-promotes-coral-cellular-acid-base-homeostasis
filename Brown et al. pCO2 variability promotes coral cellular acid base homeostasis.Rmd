---
title: "R Notebook"
output: html_notebook
---

#Script, analyses and figures for 'Environmental memory gained from exposure to extreme pCO2 variability promotes coral cellular acid-base homeostasis'
#by Kristen Brown 

```{r}
library(dplyr)
library(tidyr)
library(Rmisc)
library(lubridate)
library(ggplot2)
library(car)
library(MASS)
library(mgcv)
library(MuMIn)
library(emmeans)
library(wesanderson)
library(effects)
library(lme4)
library(nlme)
library(sjPlot)
```

##Calcification

```{r}
BWchangeo<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/Calcification by BW overall percent change.csv", strip.white=T)
BWchangeo$Origin<- as.factor(BWchangeo$Origin)
BWchangeo$Treatment<- as.factor(BWchangeo$Treatment)
BWchangeo$Colony<- as.factor(BWchangeo$Colony)
BWchangeo$Coral.ID<- as.factor(BWchangeo$Coral.ID)
BWchangeo
```

###Stats
```{r}
BWoverall.lme <- lme(Cal.day~Treatment*Origin,random= ~1|Colony, data=BWchangeo,na.action=na.exclude)
Anova(BWoverall.lme, type=3)
tukey<- emmeans(BWoverall.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```

```{r}
library(plotrix)
BWchangeosum<-BWchangeo%>%
  group_by(Origin, Treatment)%>%
  summarize_at(vars(Cal.day), funs(mean,std.error,sd,min,max), na.rm=T)
BWchangeosum
```
###Figure
```{r}
BWfigoverall<-ggplot(data=BWchangeosum, aes(y=mean, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=2, stat="identity")+
  geom_errorbar(aes(ymin=mean-std.error, ymax=mean+std.error), stat="identity",width=0.1)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_y_continuous(expression(Net~calcification~("%"~Delta~'\U2219'~day^{-1})))+
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
BWfigoverall
```

##Surface area
```{r}
savol<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/Percent change in SA and vol weekly.csv", strip.white=T)
savol$Origin<- as.factor(savol$Origin)
savol$Treatment<- as.factor(savol$Treatment)
savol$Colony<- as.factor(savol$Colony)
savol$Week<- as.factor(savol$Week)
savol$Coral.ID<- as.factor(savol$Coral.ID)
savol
```

```{r}
sa.lm<- lm(X..change.in.SA.by.day~Treatment*Origin*Week, data=savol) #Gaussian
par(mfrow=c(2,3))
plot(sa.lm, ask=FALSE, which=1:6)
```
```{r}
hist(savol$X..change.in.SA.by.day)
```
###Stats
```{r}
savol.lme <- lme(X..change.in.SA.by.day~Treatment*Origin*Week,random= ~1|Colony, data=savol,na.action=na.exclude)
Anova(savol.lme, type=3)
tukey<- emmeans(savol.lme, list(pairwise ~ Treatment:Origin), adjust = "tukey")
tukey
```
```{r}
library(plotrix)
sasum<-savol%>%
  group_by(Origin, Treatment)%>%
  summarize_at(vars(X..change.in.SA.by.day), funs(mean,std.error,sd,min,max), na.rm=T)
sasum
```
###Figure
```{r}
saoverall<-ggplot(data=sasum, aes(y=mean, x=Treatment, color=Origin),group = interaction( Treatment, Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=2, stat="identity")+
  geom_errorbar(aes(ymin=mean-std.error, ymax=mean+std.error), stat="identity",width=0.1)+
  #geom_line(aes(interaction="Origin", stat="idenity"), position= pd)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_y_continuous(expression(Surface~area~(~"%"~Delta~'\U2219'~day^{-1})))+
  #scale_x_discrete(expand=c(0.08,0.08))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
saoverall
```

#PAM - by time
```{r}
PAM<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/PAM data.csv", strip.white=T)
PAM$Origin<- as.factor(PAM$Origin)
PAM$Treatment<- as.factor(PAM$Treatment)
PAM$Colony<- as.factor(PAM$Colony)
PAM$Week<- as.factor(PAM$Week)
PAM$Coral.ID<- as.factor(PAM$Coral.ID)
PAM$Replicate<- as.factor(PAM$Replicate)
PAM$Date<-as.Date(PAM$Date)
PAM
```

```{r}
PAM<-PAM%>%
  group_by(Origin, Treatment, Colony, Week, Date, Coral.ID)%>%
  summarize_at(vars(F,M,Y), funs(mean), na.rm=T)
PAM
```
###Stats
```{r}
PAM.lme <- lme(Y~Treatment*Origin*Week,random= ~1|Colony, data=PAM,na.action=na.exclude)
Anova(PAM.lme, type=3)
PAMtukey<- emmeans(PAM.lme, list(pairwise ~ Treatment:Origin:Week), adjust = "tukey", simple ="Origin")
PAMtukey
```

```{r}
library(plotrix)
PAMsum<-PAM%>%
  group_by(Origin, Week, Treatment)%>%
  summarize_at(vars(Y), funs(mean, std.error), na.rm=T)
PAMsum
```

```{r}
pd<- position_dodge(0.5)
PAMfig<-ggplot(data=PAMsum, aes(y=mean, x=Week, color=Origin,linetype=Treatment),group = interaction( Origin,Week,Treatment))+
  geom_point(size=2, stat="identity", position = pd)+
  geom_errorbar(aes(ymin=mean-std.error, ymax=mean+std.error), stat="identity",width=0.5,  position=pd)+
  #geom_line(aes(group = interaction(Treatment, Origin), stat="identity"), position=position_dodge(0.5))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  #facet_grid(~Origin)+
  scale_y_continuous(expression(Photosynthetic~yield))+
  #scale_x_date(date_breaks = "1 day", date_labels = "%d %b %Y")+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
PAMfig
```

##PAM- overall
```{r}
PAMo<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/Overall change Y before and week 4.csv", strip.white=T)
PAMo$Origin<- as.factor(PAMo$Origin)
PAMo$Treatment<- as.factor(PAMo$Treatment)
PAMo$Colony<- as.factor(PAMo$Colony)
PAMo$Coral.ID<- as.factor(PAMo$Coral.ID)
PAMo
```

```{r}
PAMo.lme <- lme(Change~Treatment*Origin,random= ~1|Colony, data=PAMo,na.action=na.exclude)
Anova(PAMo.lme, type=3)
PAMtukey<- emmeans(PAMo.lme, list(pairwise ~ Origin), adjust = "tukey")
PAMtukey
```
```{r}
library(plotrix)
PAMchangeosum<-PAM%>%
  group_by(Treatment, Origin)%>%
  summarize_at(vars(Y), funs(mean,std.error,sd,min,max), na.rm=T)
PAMchangeosum
```

###Figure
```{r}
pamfigoverall<-ggplot(data=PAMchangeosum, aes(y=mean, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=mean-std.error, ymax=mean+std.error), stat="identity",width=0.2)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
   scale_y_continuous(expression(Photosynthetic~yield~(Fv/Fm)))+
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
pamfigoverall
```

#Physiological parameters

```{r}
d <- d<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/Heron pHi coral physiology R.csv", strip.white=T)
d$Origin<- as.factor(d$Origin)
d$Treatment<- as.factor(d$Treatment)
d$Colony<- as.factor(d$Colony)
d$Coral.ID<- as.factor(d$Coral.ID)
head(d)
```
##Protein
###Exploratory plot
```{r}
ggplot(d, aes(y=Protein..mg.cm2., x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

###Normality
```{r}
Protein.lm<- lm(Protein..mg.cm2.~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(Protein.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$Protein..mg.cm2.)
```

###Stats
```{r}
protein.lme <- lme(Protein..mg.cm2.~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(protein.lme, type=3)
tukey<- emmeans(protein.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```
###Figure

```{r}
proteinavg<-summarySE(d, measurevar='Protein..mg.cm2.', groupvars=c('Origin', 'Treatment'), na.rm=TRUE, conf.interval = 0.95)
proteinavg
```


```{r}
proteinoverall<-ggplot(data=proteinavg, aes(y=Protein..mg.cm2., x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=Protein..mg.cm2.-se, ymax=Protein..mg.cm2.+se), stat="identity",width=0.2)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
   scale_y_continuous(expression(Protein~density~(mg~'\U2219'~cm^{-2})))+
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
proteinoverall
```

##Mycosporine-like amino acids

###Mycosporine-gylcine
####Exploratory plot
```{r}
ggplot(d, aes(y=A310.A280, x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
MAA1.lm<- lm(A310.A280~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(MAA1.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$A310.A280)
```

####Stats
```{r}
MAA1.lme <- lme(A310.A280~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(MAA1.lm, type=3)
tukey<- emmeans(MAA1.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
####Figure

```{r}
maa1avg<-summarySE(d, measurevar='A310.A280', groupvars=c('Treatment', "Origin"), na.rm=TRUE, conf.interval = 0.95)
maa1avg
```


```{r}
maa1fig<-ggplot(maa1avg, aes(y=A310.A280, x=Treatment, color=Origin))+ 
  geom_point(size=3, stat="identity")+
   geom_errorbar(aes(ymin=A310.A280-se, ymax=A310.A280+se, width= 0.2)) +
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  scale_y_continuous(expression(Mycosporine~glycine~(mg~'\U2219'~cm^{-2})))+  
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Flat"='indianred', "Slope"= "paleturquoise3"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position='none',
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
maa1fig
```
###Palythine
####Exploratory plot
```{r}
ggplot(d, aes(y=A320.A280, x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
MAA2.lm<- lm(A320.A280~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(MAA2.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$A320.A280)
```

####Stats
```{r}
MAA2.lme <- lme(A320.A280~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(MAA2.lme, type=3)
tukey<- emmeans(MAA2.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
maa2avg<-summarySE(d, measurevar='A320.A280', groupvars=c('Treatment', "Origin"), na.rm=TRUE, conf.interval = 0.95)
maa2avg
```


```{r}
maa2fig<-ggplot(maa2avg, aes(y=A320.A280, x=Treatment, color=Origin))+ 
  geom_point(size=3, stat="identity")+
   geom_errorbar(aes(ymin=A320.A280-se, ymax=A320.A280+se, width= 0.2)) +
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  scale_y_continuous(expression(Palythine~(mg~'\U2219'~cm^{-2})))+  
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Flat"='indianred', "Slope"= "paleturquoise3"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position='none',
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
maa2fig
```
###Asterina
####Exploratory plot
```{r}
ggplot(d, aes(y=A330.A280, x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
MAA3.lm<- lm(A330.A280~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(MAA3.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$A330.A280)
```

####Stats
```{r}
MAA3.lme <- lme(A330.A280~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(MAA3.lme, type=3)
tukey<- emmeans(MAA3.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
maa3avg<-summarySE(d, measurevar='A330.A280', groupvars=c('Treatment', "Origin"), na.rm=TRUE, conf.interval = 0.95)
maa3avg
```


```{r}
maa3fig<-ggplot(maa3avg, aes(y=A330.A280, x=Treatment, color=Origin))+ 
  geom_point(size=3, stat="identity")+
   geom_errorbar(aes(ymin=A330.A280-se, ymax=A330.A280+se, width= 0.2)) +
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  scale_y_continuous(expression(Asterina~(mg~'\U2219'~cm^{-2})))+  
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Flat"='indianred', "Slope"= "paleturquoise3"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position='none',
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
maa3fig
```
###Shinorine
####Exploratory plot
```{r}
ggplot(d, aes(y=A334.A280, x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
MAA4.lm<- lm(A334.A280~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(MAA4.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$A334.A280)
```

####Stats
```{r}
MAA4.lme <- lme(A334.A280~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(MAA4.lme, type=3)
tukey<- emmeans(MAA4.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
maa4avg<-summarySE(d, measurevar='A334.A280', groupvars=c('Treatment', "Origin"), na.rm=TRUE, conf.interval = 0.95)
maa4avg
```


```{r}
maa4fig<-ggplot(maa4avg, aes(y=A334.A280, x=Treatment, color=Origin))+ 
  geom_point(size=3, stat="identity")+
   geom_errorbar(aes(ymin=A334.A280-se, ymax=A334.A280+se, width= 0.2)) +
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  scale_y_continuous(expression(Shinorine~(mg~'\U2219'~cm^{-2})))+  
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Flat"='indianred', "Slope"= "paleturquoise3"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position='none',
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
maa4fig
```
###Symbiont densities
####Exploratory plot
```{r}
ggplot(d, aes(y=Million.Zoox.per.cm2, x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
sym.lm<- lm(Million.Zoox.per.cm2~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(sym.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$Million.Zoox.per.cm2)
```

####Stats
```{r}
sym.lme <- lme(Million.Zoox.per.cm2~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(sym.lme, type=3)
tukey<- emmeans(sym.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```

####Figure
```{r}
symavg<-summarySE(d, measurevar='Million.Zoox.per.cm2', groupvars=c('Origin', 'Treatment'), na.rm=TRUE, conf.interval = 0.95)
symavg
```

```{r}
pd<- position_dodge(0.6)
symoverall<-ggplot(data=symavg, aes(y=Million.Zoox.per.cm2, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=Million.Zoox.per.cm2-se, ymax=Million.Zoox.per.cm2+se), stat="identity",width=0.2,)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
   scale_y_continuous(expression(Symbiont~density~(10^{6}~cells~'\U2219'~cm^{-2})))+
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
symoverall
```
###Chlorophyll a
####Exploratory plot
```{r}
ggplot(d, aes(y=pg.Chl.a.per.cm2, x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
chla.lm<- lm(pg.Chl.a.per.cm2~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(chla.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$pg.Chl.a.per.cm2)
```

####Stats
```{r}
chla.lme <- lme(pg.Chl.a.per.cm2~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(chla.lme, type=3)
tukey<- emmeans(chla.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```
###Figure
```{r}
chlavg<-summarySE(d, measurevar='pg.Chl.a.per.cm2', groupvars=c('Origin', 'Treatment'), na.rm=TRUE, conf.interval = 0.95)
chlavg
```


```{r}
pd<- position_dodge(0.6)
chlaoverall<-ggplot(data=chlavg, aes(y=pg.Chl.a.per.cm2, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=pg.Chl.a.per.cm2-se, ymax=pg.Chl.a.per.cm2+se), stat="identity",width=0.2)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
   scale_y_continuous(expression(Chlorophyll~a~(pg~'\U2219'~cell^{-1})))+
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
chlaoverall
```



##Skeleton

###CaCO3 density
####Exploratory plot
```{r}
ggplot(d, aes(y=CaCO3.Density..g.ml., x=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
density.lm<- lm(CaCO3.Density..g.ml.~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(density.lm, ask=FALSE, which=1:6)
```


```{r}
hist(d$CaCO3.Density..g.ml.)
```

####Stats
```{r}
density.lme <- lme(CaCO3.Density..g.ml.~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(density.lme, type=3)
tukey<- emmeans(density.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
tukey<- emmeans(density.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```
```{r}
densityavg<-summarySE(d, measurevar='CaCO3.Density..g.ml.', groupvars=c('Treatment', "Origin"), na.rm=TRUE, conf.interval = 0.95)
densityavg
```
```{r}
densityavgo<-summarySE(d, measurevar='CaCO3.Density..g.ml.', groupvars=c('Origin'), na.rm=TRUE, conf.interval = 0.95)
densityavgo
```


####Figure
```{r}
densityfig<-ggplot(densityavg, aes(y=CaCO3.Density..g.ml., x=Treatment, color=Origin, group=interaction(Origin, Treatment)))+ 
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
   geom_errorbar(aes(ymin=CaCO3.Density..g.ml.-se, ymax=CaCO3.Density..g.ml.+se, width= 0.1),stat="identity") +
  scale_y_continuous(expression(CaCO[3]~density~(g~'\U2219'~mL^{-1})))+  
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Treatment", values=c("Flat"='indianred', "Slope"= "paleturquoise3"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
densityfig
```
```{r}
densityfigo<-ggplot(densityavgo, aes(y=CaCO3.Density..g.ml., x=Origin, color=Origin, group=interaction(Origin)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=CaCO3.Density..g.ml.-se, ymax=CaCO3.Density..g.ml.+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(CaCO[3]~density~(g~'\U2219'~mL^{-1})))+  
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Treatment", values=c("Slope"='navyblue', "Flat"= "paleturquoise3"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
densityfigo
```

###Bulk density
####Exploratory plot
```{r}
ggplot(d, aes(y=Bulk.Density..g.ml., x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
bulk.lm<- lm(Bulk.Density..g.ml.~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(bulk.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$CaCO3.Density..g.ml.)
```

####Stats
```{r}
bulk.lme <- lme(Bulk.Density..g.ml.~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(bulk.lme, type=3)
tukey<- emmeans(bulk.lme, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
bulkavg<-summarySE(d, measurevar='Bulk.Density..g.ml.', groupvars=c('Origin'), na.rm=TRUE, conf.interval = 0.95)
bulkavg
```
####Figure
```{r}
bulkfig<-ggplot(bulkavg, aes(y=Bulk.Density..g.ml., x=Origin, color=Origin, group=interaction(Origin)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=Bulk.Density..g.ml.-se, ymax=Bulk.Density..g.ml.+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(Skeletal~bulk~density~(g~'\U2219'~mL^{-1})))+  
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position=c(0.85,0.15),
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
bulkfig
```
```{r}
library(cowplot)
cal3<-plot_grid(BWfigoverall,saoverall,densityfig,nrow=1, ncol=3,  align="h", axis = "bt")
cal3
```

###Internal volume
####Exploratory plot
```{r}
ggplot(d, aes(y=X.internal.volume, x=Origin, fill=Treatment))+ 
  geom_boxplot()+
  geom_point(color="black")+
  theme_classic()
```

####Normality
```{r}
intvol.lm<- lm(X.internal.volume~Origin*Treatment, data=d) #Gaussian
par(mfrow=c(2,3))
plot(intvol.lm, ask=FALSE, which=1:6)
```

```{r}
hist(d$X.internal.volume)
```

####Stats
```{r}
intvol.lme <- lme(X.internal.volume~Treatment*Origin,random= ~1|Colony, data=d,na.action=na.exclude)
Anova(intvol.lme, type=3)
tukey<- emmeans(intvol.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```
##Respirometry

```{r}
resp <-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/Respirometry analysis.csv", strip.white=T)
resp$Origin<- as.factor(resp$Origin)
resp$Treatment<- as.factor(resp$Treatment)
resp$Colony<- as.factor(resp$Colony)
resp$Coral.ID<- as.factor(resp$Coral.ID)
head(resp)
```

```{r}
DR.lme <- lme(DR~Treatment*Origin,random= ~1|Colony, data=resp,na.action=na.exclude)
Anova(DR.lme, type=3)
tukey<- emmeans(DR.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```
```{r}
DRsum<-summarySE(resp, measurevar='DR', groupvars=c('Origin', 'Treatment'), na.rm=TRUE, conf.interval = 0.95)
DRsum
```

```{r}
DRsum2<-summarySE(resp, measurevar='DR', groupvars=c('Origin'), na.rm=TRUE, conf.interval = 0.95)
DRsum2
```

```{r}
DRsum3<-summarySE(resp, measurevar='DR', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
DRsum3
```



```{r}
pd<- position_dodge(0.6)
DRfig<-ggplot(data=DRsum, aes(y=DR, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=DR-se, ymax=DR+se), stat="identity",width=0.2)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
   scale_y_continuous(expression(Dark~respiration~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
DRfig
```


####Figure

```{r}
DRfig2<-ggplot(DRsum, aes(y=DR, x=Origin, color=Origin, linetype=Treatment, group=interaction(Origin, Treatment)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=DR-se, ymax=DR+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(Dark~respiration~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+ 
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
DRfig2
```


####Figure
```{r}
DRfig3<-ggplot(DRsum2, aes(y=DR, x=Origin, color=Origin, group=interaction(Origin)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=DR-se, ymax=DR+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(Dark~respiration~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+ 
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
DRfig3
```

```{r}
Pnet.lm<- lm(Pnet~Origin*Treatment, data=resp) #Gaussian
par(mfrow=c(2,3))
plot(Pnet.lm, ask=FALSE, which=1:6)
```

```{r}
hist(resp$Pnet)
```

```{r}
Pnet.lme <- lme(Pnet~Treatment*Origin,random= ~1|Colony, data=resp,na.action=na.exclude)
Anova(Pnet.lme, type=3)
tukey<- emmeans(Pnet.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```
```{r}
pnetsum<-summarySE(resp, measurevar='Pnet', groupvars=c('Origin'), na.rm=TRUE, conf.interval = 0.95)
pnetsum
```

```{r}
pnetsum1<-summarySE(resp, measurevar='Pnet', groupvars=c('Treatment'), na.rm=TRUE, conf.interval = 0.95)
pnetsum1
```
```{r}
pnetsum3<-summarySE(resp, measurevar='Pnet', groupvars=c('Origin','Treatment'), na.rm=TRUE, conf.interval = 0.95)
pnetsum3
```
```{r}
pd<- position_dodge(0.6)
Pnetfig<-ggplot(data=pnetsum3, aes(y=Pnet, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=2, stat="identity")+
  geom_errorbar(aes(ymin=Pnet-se, ymax=Pnet+se), stat="identity",width=0.2)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
   scale_y_continuous(expression(Net~photosynthesis~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
Pnetfig
```
####Figure
```{r}
pnetfig2<-ggplot(pnetsum1, aes(y=Pnet, x=Treatment, linetype=Treatment, group=interaction(Treatment)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=Pnet-se, ymax=Pnet+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(Net~photosynthesis~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+ 
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
pnetfig2
```

####Figure
```{r}
pnetfig<-ggplot(pnetsum, aes(y=Pnet, x=Origin, color=Origin, group=interaction(Origin)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=Pnet-se, ymax=Pnet+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(Net~photosynthesis~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+ 
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
pnetfig
```
```{r}
pnetfig3<-ggplot(pnetsum3, aes(y=Pnet, x=Origin, color=Origin, linetype=Treatment, group=interaction(Origin, Treatment)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=Pnet-se, ymax=Pnet+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(Net~photosynthesis~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+ 
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
pnetfig3
```

```{r}
LEDR.lme <- lme(LEDR~Treatment*Origin,random= ~1|Colony, data=resp,na.action=na.exclude)
Anova(LEDR.lme, type=3)
tukey<- emmeans(LEDR.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```

```{r}
LEDRsum<-summarySE(resp, measurevar='LEDR', groupvars=c('Origin', 'Treatment'), na.rm=TRUE, conf.interval = 0.95)
LEDRsum
```

####Figure
```{r}
LEDRfig<-ggplot(LEDRsum, aes(y=LEDR, x=Origin, color=Origin, linetype=Treatment, group=interaction(Origin, Treatment)))+ 
  geom_point(size=3, position=position_dodge(width=0.5),stat="identity")+
   geom_errorbar(aes(ymin=LEDR-se, ymax=LEDR+se, width= 0.5), position=position_dodge2( preserve = "single"),stat="identity") +
  scale_y_continuous(expression(Light~enhanced~dark~respiration~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+ 
  #scale_shape_manual("Treatment",values=c("Adult"=(pch=4),"Juvenile"=(pch=19)))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),
        axis.text.y=element_text(vjust=0.5, size=12),
        axis.title.x=element_blank(),
        axis.title.y=element_text(size=12),
        legend.text = element_text(vjust=0.5, size=12),
        legend.position="none",
        panel.background= element_rect(fill=NA, color='black'),
        strip.text = element_text(face="italic", size=12))
LEDRfig
```


```{r}
pd<- position_dodge(0.6)
LEDRfig<-ggplot(data=LEDRsum, aes(y=LEDR, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=LEDR-se, ymax=LEDR+se), stat="identity",width=0.2)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_y_continuous(expression(Light~enhanced~dark~respiration~(mu~mol~'\U2219'~h^{-1}~'\U2219'~cm^{-2})))+ 
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
LEDRfig
```

```{r}
PR.lme <- lme(PR~Treatment*Origin,random= ~1|Colony, data=resp,na.action=na.exclude)
Anova(PR.lme, type=3)
tukey<- emmeans(PR.lme, list(pairwise ~ Origin), adjust = "tukey")
tukey
```

```{r}
PRsum<-summarySE(resp, measurevar='PR', groupvars=c('Origin', 'Treatment'), na.rm=TRUE, conf.interval = 0.95)
PRsum
```

####Figure

```{r}
pd<- position_dodge(0.2)
PRfig<-ggplot(data=PRsum, aes(y=PR, x=Treatment, color=Origin),group = interaction(Origin))+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  geom_point(size=3, stat="identity")+
  geom_errorbar(aes(ymin=PR-se, ymax=PR+se), stat="identity",width=0.2)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_y_continuous(expression(Photosynthesis~to~respiration~ratio))+ 
  #geom_hline(yintercept = 0.0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
PRfig
```


####Composite figure
```{r}
library(cowplot)
respfigs<-plot_grid(PRfig, Pnetfig,DRfig,LEDRfig, ncol=2,nrow=2, align="h", axis = "bt")
respfigs
```

```{r}
library(cowplot)
phys4<-plot_grid(PRfig,DRfig,LEDRfig,proteinoverall,maa1fig,maa2fig,maa3fig,maa4fig, Pnetfig, pamfigoverall,symoverall,chlaoverall, nrow=3, ncol=4,  align="h", axis = "bt")
phys4
```

#pHi
###Overall

```{r}
c<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/Heron pHi experiment_pH challenge_confocal analyses.csv", strip.white=T)
c$Origin<- as.factor(c$Origin)
c$Treatment<- as.factor(c$Treatment)
c$Colony<- as.factor(c$Colony)
c$Time<- as.factor(c$Time)
c$Coral.ID<- as.factor(c$Coral.ID)
c$Cell.type<- as.factor(c$Cell.type)
c$Confidence<- as.factor(c$Confidence)
c<-c[!apply(c == "", 1, all),]
c = c %>% na.omit()
c
```
```{r}
c16<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Heron experiment/16-bit pHi revised.csv", strip.white=T)
c16$Origin<- as.factor(c16$Origin)
c16$Treatment<- as.factor(c16$Treatment)
c16$Colony<- as.factor(c16$Colony)
c16$Time<- as.factor(c16$Time)
c16$Coral.ID<- as.factor(c16$Coral.ID)
c16$Cell.type<- as.factor(c16$Cell.type)
c16$Confidence<- as.factor(c16$Confidence)
c16<-c16[!apply(c16 == "", 1, all),]
c16 = c16 %>% na.omit()
c16
```
```{r}
colnames(c)
```

```{r}
allc<-merge(c,c16, by=c("Coral.ID","Origin","Colony","Treatment","Time","Cell.type","Confidence","pHi"), all=T)
allc
```

```{r}
hist(allc$pHi)
```
```{r}
c0<-filter(allc, Confidence== "0")
hist(c0$pHi)
```
```{r}
unique(c$Treatment)
unique(c$Origin)
unique(c$Time)
```

```{r}
library(lme4)
c.lm<- lm(pHi~Treatment*Origin*Time*Cell.type, data=allc, na.action = na.exclude)
Anova(c.lm, type=3)
tukey<- emmeans(c.lm, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```

```{r}
treatavg<-summarySE(allc, measurevar="pHi", groupvars=c("Treatment", 'Time',"Cell.type"), na.rm=TRUE)
treatavg
```
```{r}
pd<- position_dodge(0.3)
cfigt<-ggplot(data=subset(treatavg, !is.na(pHi)),aes(y=pHi, x=Time, linetype=Treatment),group = interaction(Time, Treatment))+
  geom_point(size=2, stat="identity", position = pd)+
  geom_errorbar(aes(ymin=pHi-se, ymax=pHi+se), stat="identity",width=0.5,  position=pd)+
  geom_line(aes(group = interaction(Treatment), stat="identity"), position=position_dodge(0.5))+
  #scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "navyblue", "NA"="white"))+
  #scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "navyblue", "NA"="white"))+
  scale_linetype_manual("Treatment", values=c(2,1,3))+
  facet_wrap(~Cell.type)+
  scale_y_continuous(expression(pHi))+
  scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("0","15","30","45","60","75"))+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
cfigt
```

```{r}
originavg<-summarySE(allc, measurevar="pHi", groupvars=c("Origin", 'Time',"Cell.type"), na.rm=TRUE)
originavg
```

```{r}
pd<- position_dodge(0.3)
cfigo<-ggplot(data=subset(originavg, !is.na(pHi)), aes(y=pHi, x=Time, color=Origin),group = interaction(Time, Origin))+
  geom_jitter(data=allc,aes(y=pHi, x=Time, color=Origin), alpha=0.2)+
  geom_point(size=2, stat="identity", position = pd)+
  geom_errorbar(aes(ymin=pHi-se, ymax=pHi+se), stat="identity",width=0.5,  position=pd, size=1.25)+
  geom_line(aes(group = interaction(Origin), stat="identity"), position=position_dodge(0.5), size=1.25)+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_y_continuous(expression(pHi), limits=c(6.5,8))+
  scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("0","15","30","45","60","75"),expand=c(0.015,0.015))+
  facet_wrap(~Cell.type,scales='free')+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
cfigo
```

```{r}
allavg<-summarySE(allc, measurevar="pHi", groupvars=c("Treatment","Origin", 'Time','Cell.type'), na.rm=TRUE)
allavg
```


```{r}
pd<- position_dodge(0.5)
cfigtime<-ggplot(data=subset(allavg, !is.na(pHi)), aes(y=pHi, x=Time, color=Origin, linetype=Treatment),group = interaction(Treatment, Time, Origin))+
  geom_point(size=2, stat="identity", position = pd)+
  geom_errorbar(aes(ymin=pHi-se, ymax=pHi+se), stat="identity",width=0.5,  position=pd)+
  geom_line(aes(group = interaction(Treatment, Origin), stat="identity"), position=position_dodge(0.5))+
  scale_linetype_manual("Treatment", values=c(2,1,3))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "navyblue", "NA"="white"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "navyblue", "NA"="white"))+
  facet_grid(~Cell.type)+
  scale_y_continuous(expression(pHi))+
  scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("0","15","30","45","60","75"))+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
cfigtime
```
```{r}
library(cowplot)
cfigs<-cowplot::plot_grid(cfigt,cfigo, nrow=2, align="h", axis = "bt")
cfigs
```

###Initial pHi

```{r}
initialpHi<-filter(allc, Time== "0")
initialpHi
```
####Stats

```{r}
library(lme4)
initial.lm<- lm(pHi~Treatment*Origin*Cell.type, data=initialpHi, na.action = na.exclude)
Anova(initial.lm, type=3)
tukey<- emmeans(initial.lm, list(pairwise ~ Treatment), adjust = "tukey")
tukey
```
```{r}
initialavg<-summarySE(initialpHi, measurevar="pHi", groupvars=c("Treatment", 'Origin',"Cell.type"), na.rm=TRUE)
initialavg
```


```{r}
pd<- position_dodge(0.4)
initialfig<-ggplot(initialavg, aes(y=pHi, x=Treatment, color=Origin))+
  geom_point(size=2, stat="identity", position = pd)+
  geom_errorbar(aes(ymin=pHi-se, ymax=pHi+se), stat="identity",width=0.5,  position=pd)+
  geom_line(aes(group = interaction(Origin), stat="identity"), position=position_dodge(0.5))+
 scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_y_continuous(expression(Initial~pHi))+
  #scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("0","15","30","45","60","75"))+
  facet_wrap(~Cell.type)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        strip.text =  element_text(vjust=0.5,size=12),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position=c(0.15,0.7),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
initialfig
```
###Slope
```{r}
pHislope<-filter(allc, Time== c("1","2","3","4"))
pHislope

slope<-pHislope%>%
  dplyr::group_by(Treatment, Origin, Cell.type, Coral.ID) %>%
  dplyr::mutate(rownum = row_number()) %>% 
  dplyr::summarise(slope = lm(pHi ~ rownum)$coefficients['rownum'])
slope
```

```{r}
slopesum2o<-summarySE(slope, measurevar="slope", groupvars=c("Origin", "Cell.type"), na.rm=TRUE)
slopesum2o
```
```{r}
pd<- position_dodge(0.41)
sloperxnfigo<-ggplot(slopesum2o, aes(y=slope, x=Origin, color=Origin))+
  geom_point(size=2, stat="identity", position = pd)+
  #geom_jitter(data=slope,aes(y=slope, x=Origin, color=Origin), alpha=0.2, size=1.5)+
  geom_errorbar(aes(ymin=slope-se, ymax=slope+se), stat="identity",width=0.2,  position=pd)+
  geom_line(aes(group = interaction(Origin), stat="identity"), position=position_dodge(0.5))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_y_continuous(expression(Rate~of~pHi~recovery), limits=c(0.05,0.13))+
  scale_x_discrete(expand=c(0.015,0.015))+
  facet_wrap(~Cell.type, scales = "free")+
  #geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.75, show.legend = TRUE)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        strip.text = element_text(vjust=0.5,size=12),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
sloperxnfigo
```

```{r}
slopesum2<-summarySE(slope, measurevar="slope", groupvars=c("Origin", 'Treatment',"Cell.type"), na.rm=TRUE)
slopesum2
```
```{r}
pd<- position_dodge(0.41)
sloperxnfig<-ggplot(slopesum2, aes(y=slope, x=Treatment, color=Origin))+
  geom_point(size=2, stat="identity", position = pd)+
  geom_errorbar(aes(ymin=slope-se, ymax=slope+se), stat="identity",width=0.2,  position=pd)+
  geom_line(aes(group = interaction(Origin), stat="identity"), position=position_dodge(0.5))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  #scale_y_continuous(expression(Delta~pHi~(15-0)), limits=c(-0.35,0.02))+
  scale_x_discrete(expand=c(0.015,0.015))+
  facet_wrap(~Cell.type, scales = "free")+
  #geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.75, show.legend = TRUE)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        strip.text = element_text(vjust=0.5,size=12),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
sloperxnfig
```

####Stats

```{r}
library(lme4)
slope.lm<- lm(pHi~Treatment*Origin*Cell.type, data=pHislope, na.action = na.exclude)
Anova(slope.lm, type=3)
tukey<- emmeans(slope.lm, list(pairwise ~ Cell.type), adjust = "tukey")
tukey
tukey<- emmeans(slope.lm, list(pairwise ~ Origin), adjust = "tukey")
tukey
tukey<- emmeans(slope.lm, list(pairwise ~ Origin*Cell.type), adjust = "tukey")
tukey
```
```{r}
library(lme4)
slope.lm2<- lm(pHi~Origin*Cell.type, data=pHislope, na.action = na.exclude)
Anova(slope.lm2, type=3)
summary(slope.lm2)
tukey<- emmeans(slope.lm2, list(pairwise ~ Origin:Cell.type), adjust = "tukey")
tukey
```

```{r}
slopesum<-summarySE(pHislope, measurevar="pHi", groupvars=c("Origin", 'Treatment', 'Time',"Cell.type"), na.rm=TRUE)
slopesum
```
```{r}
pd<- position_dodge(0.6)
slopefig<-ggplot(slopesum, aes(y=pHi, x=Time, color=Origin, linetype=Treatment))+
  geom_point(size=2, position=pd)+
  geom_errorbar(aes(ymin=pHi-se, ymax=pHi+se), stat="identity",width=0.5,  position=pd)+
  geom_line(aes(group = interaction(Origin, Treatment), stat="identity"), position=position_dodge(0.5))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_linetype_manual("Treatment", values=c(2,1,3))+
  scale_y_continuous(expression(pHi))+
  scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("15","30","45","60","75"))+
  facet_wrap(~Cell.type)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        strip.text = element_text(vjust=0.5,size=12),
        legend.title = element_text(vjust=0.5,size=12),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
slopefig
```

```{r}
pd<- position_dodge(0.3)
slopefig1<-ggplot(pHislope, aes(y=pHi, x=Time, color=Origin, fill=Origin, linetype=Treatment))+
  #geom_point(size=1, position=pd)+
  geom_smooth(aes(as.numeric(Time)),method = "lm")+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_linetype_manual("Treatment", values=c(2,1,3))+
  scale_y_continuous(expression(pHi))+
  scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("15","30","45","60","75"))+
  facet_wrap(~Cell.type)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
slopefig1
```
```{r}
slopesumo<-summarySE(pHislope, measurevar="pHi", groupvars=c("Origin", 'Time', 'Cell.type'), na.rm=TRUE)
slopesumo
```

```{r}
pd<- position_dodge(0.6)
slopefigo<-ggplot(slopesumo, aes(y=pHi, x=Time, color=Origin))+
  geom_point(size=2, position=pd)+
  geom_errorbar(aes(ymin=pHi-se, ymax=pHi+se), stat="identity",width=0.5,  position=pd)+
  geom_line(aes(group = interaction(Origin), stat="identity"), position=position_dodge(0.5))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_y_continuous(expression(pHi))+
  scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("15","30","45","60","75"))+
  facet_wrap(~Cell.type)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        strip.text = element_text(vjust=0.5,size=12),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
slopefigo
```

```{r}
pd<- position_dodge(0.3)
slopefigo1<-ggplot(pHislope, aes(y=pHi, x=Time, color=Origin, fill=Origin))+
  #geom_point(size=1, position=pd)+
  geom_smooth(aes(as.numeric(Time)),method = "lm")+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred"))+
  #scale_linetype_manual("Treatment", values=c(2,1,3))+
  #coord_cartesian(xlim=c(1,4), ylim=c(5,9)) +
  scale_y_continuous(expression(pHi))+
  scale_x_discrete(expression(Time~post-acidification~"(min)"),labels=c("15","30","45","60"))+
  #facet_wrap(~Cell.type)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        #strip.text = element_blank(),
        legend.title = element_text(vjust=0.5,size=12),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
slopefigo1
```

```{r}
library(cowplot)
slopefigs<-cowplot::plot_grid(slopefig,slopefig1, nrow=2, align="h", axis = "bt")
slopefigs
```


###Drop
```{r}
pHi15<-allc %>% 
  group_by("Coral.ID","Origin","Treatment","Time","Cell.type")%>% 
  filter(Time== c("1"))
pHi15<-plyr::rename(pHi15, c("pHi"= "pHi_15"))
pHi15
pHi0<-allc %>% 
  group_by("Coral.ID","Origin","Treatment","Time","Cell.type")%>% 
  filter(Time== c("0"))
pHi0<-plyr::rename(pHi0, c("pHi"= "pHi_0"))
pHi0

drop<-merge(pHi0,pHi15, by=c("Coral.ID","Origin","Colony","Treatment","Cell.type"), all=T)
drop
```

```{r}
dropmean$change <- (drop$pHi_15 - drop$pHi_0)
dropmean
```

```{r}
drop$change <- (drop$pHi_15 - drop$pHi_0)
drop
```
####Stats

```{r}
library(lme4)
drop.lm<- lm(change~Treatment*Origin*Cell.type, data=drop, na.action = na.exclude)
Anova(drop.lm, type=3)
tukey<- emmeans(drop.lm, list(pairwise ~ Treatment:Origin:Cell.type), adjust = "tukey", simple= "Origin")
tukey
```
```{r}
dropavg<-summarySE(drop, measurevar="change", groupvars=c("Treatment", 'Origin',"Cell.type"), na.rm=TRUE)
dropavg
```
```{r}
dropfig<-ggplot(dropavg, aes(y=change, x=Treatment, color=Origin))+
  #geom_jitter(data=drop,aes(y=change, x=Treatment, color=Origin), alpha=0.2)+
  geom_point(size=2, stat="identity")+
  geom_errorbar(aes(ymin=change-se, ymax=change+se), stat="identity",width=0.1)+
  geom_line(aes(group = interaction(Origin), stat="identity"))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_y_continuous(expression(Delta~pHi~(15-0)), limits=c(-0.35,0.02))+
  #scale_x_discrete(expand=c(0.015,0.015))+
  facet_wrap(~Cell.type, scales = "free")+
  #geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.75, show.legend = TRUE)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        strip.text = element_text(vjust=0.5,size=12),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
dropfig
```

```{r}
pd<- position_dodge(0.41)
dropfig<-ggplot(dropavg, aes(y=change, x=Treatment, color=Origin))+
  #geom_jitter(data=drop,aes(y=change, x=Treatment, color=Origin), alpha=0.2)+
  geom_point(size=2, stat="identity", position = pd)+
  geom_errorbar(aes(ymin=change-se, ymax=change+se), stat="identity",width=0.2,  position=pd)+
  geom_line(aes(group = interaction(Origin), stat="identity"), position=position_dodge(0.5))+
  scale_fill_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_color_manual("Origin", values=c("Slope"='paleturquoise3', "Flat"= "indianred", "NA"="white"))+
  scale_y_continuous(expression(Delta~pHi~(15-0)), limits=c(-0.35,0.02))+
  scale_x_discrete(expand=c(0.015,0.015))+
  facet_wrap(~Cell.type, scales = "free")+
  #geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.75, show.legend = TRUE)+
  #scale_x_date(date_breaks = "10 days", date_labels = "%d %b %Y")+
  #geom_text(x=as.numeric(as.Date("2021-01-29")), y = 19, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #strip.background = element_blank(), 
        strip.text = element_text(vjust=0.5,size=12),
        legend.title = element_text(vjust=0.5,size=12),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
dropfig
```

```{r}
pHifigs<-plot_grid(initialfig, slopefigo,dropfig, ncol=1,nrow=3, align="h", axis = "bt")
pHifigs
```
